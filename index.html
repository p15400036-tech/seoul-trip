<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–çˆ¾æ—…è¨˜ SEOUL 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- è¨­è¨ˆé¢¨æ ¼ï¼šThreads / ç„¡å°æ¥µç°¡é¢¨ --- */
        :root {
            --bg-color: #f8f8f6; /* ç±³ç™½èƒŒæ™¯ */
            --card-bg: #ffffff;
            --text-main: #1a1a1a;
            --text-sub: #999999;
            --accent: #333333;
            --radius: 18px;
            --shadow: 0 2px 12px rgba(0,0,0,0.04);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-font-smoothing: antialiased; }
        body { background-color: var(--bg-color); color: var(--text-main); max-width: 500px; margin: 0 auto; min-height: 100vh; padding-bottom: 100px; }
        
        /* é ‚éƒ¨å°èˆª */
        header { padding: 25px 20px; background: var(--bg-color); position: sticky; top: 0; z-index: 100; }
        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .weather-btn { background: #fff; border: 1px solid #eee; padding: 8px 12px; border-radius: 30px; font-size: 13px; text-decoration: none; color: var(--text-main); display: flex; align-items: center; box-shadow: var(--shadow); }
        h1 { font-size: 26px; font-weight: 800; letter-spacing: -0.5px; }
        .subtitle { font-size: 14px; color: var(--text-sub); margin-top: 5px; }

        /* åˆ†é åˆ‡æ› */
        .tabs { display: flex; background: #eaeaea; padding: 4px; border-radius: 14px; margin-top: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; font-size: 14px; border-radius: 12px; cursor: pointer; color: #777; font-weight: 600; transition: 0.2s; }
        .tab.active { background: #fff; color: #000; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* å…§å®¹å€å¡Š */
        .content-section { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* è¡Œç¨‹å¡ç‰‡ */
        .day-header { font-size: 18px; font-weight: 700; margin: 25px 0 12px 0; color: var(--accent); display: flex; align-items: center; }
        .day-header span { background: var(--text-main); color: #fff; font-size: 12px; padding: 2px 8px; border-radius: 4px; margin-right: 8px; }
        
        .card { background: var(--card-bg); border-radius: var(--radius); padding: 18px; margin-bottom: 16px; box-shadow: var(--shadow); border: 1px solid #f0f0f0; position: relative; }
        .card-time { font-size: 13px; color: var(--text-sub); font-weight: 600; margin-bottom: 6px; display: block; }
        .card-title { font-size: 17px; font-weight: 700; margin-bottom: 6px; color: var(--text-main); }
        .card-desc { font-size: 14px; color: #666; line-height: 1.5; margin-bottom: 12px; white-space: pre-wrap; }
        
        .naver-btn { display: inline-block; background: #03C75A; color: white; padding: 8px 16px; border-radius: 10px; text-decoration: none; font-size: 13px; font-weight: 600; width: 100%; text-align: center; }
        .delete-btn { position: absolute; top: 18px; right: 18px; color: #e0e0e0; cursor: pointer; font-size: 14px; }
        .delete-btn:hover { color: #ff4d4d; }

        /* è¨˜å¸³æ¨£å¼ */
        .total-card { background: var(--text-main); color: #fff; padding: 25px; border-radius: var(--radius); margin-bottom: 25px; text-align: center; }
        .total-card .label { font-size: 13px; opacity: 0.7; margin-bottom: 5px; }
        .total-card .amount { font-size: 32px; font-weight: 700; }
        .total-card .rate { font-size: 12px; opacity: 0.5; margin-top: 10px; }

        .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid #eee; }
        .expense-left h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .expense-left p { font-size: 12px; color: var(--text-sub); }
        .expense-right { text-align: right; }
        .expense-twd { font-size: 16px; font-weight: 700; color: var(--text-main); }
        .expense-krw { font-size: 12px; color: var(--text-sub); }

        /* æµ®å‹•æŒ‰éˆ• & è¡¨å–® */
        .fab { position: fixed; bottom: 30px; right: 25px; background: #000; color: #fff; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; box-shadow: 0 8px 20px rgba(0,0,0,0.25); cursor: pointer; z-index: 200; transition: 0.2s; }
        .fab:active { transform: scale(0.9); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-content { background: #fff; padding: 25px; width: 90%; max-width: 400px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; }
        .form-input { width: 100%; padding: 14px; background: #f9f9f9; border: 1px solid #eee; border-radius: 12px; font-size: 16px; outline: none; }
        .form-input:focus { border-color: #000; background: #fff; }
        
        .btn-group { display: flex; gap: 12px; margin-top: 25px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; }
        .btn-cancel { background: #f5f5f5; color: #666; }
        .btn-submit { background: #000; color: #fff; }

        #sync-dot { width: 8px; height: 8px; background: #03C75A; border-radius: 50%; display: inline-block; margin-left: 5px; display: none; }
    </style>
</head>
<body>

    <header>
        <div class="top-row">
            <!-- å¤©æ°£æŒ‰éˆ• (å°å‘ AccuWeather) -->
            <a href="https://www.accuweather.com/zh/kr/seoul/226081/weather-forecast/226081" target="_blank" class="weather-btn">
                <i class="fas fa-cloud" style="margin-right:8px"></i> é¦–çˆ¾å¤©æ°£ <div id="sync-dot"></div>
            </a>
            <div style="font-size:12px; color:#ccc;">Synced</div>
        </div>
        <h1>SEOUL TRIP <span style="font-weight:300">2025</span></h1>
        <p class="subtitle">ç•¢æ¥­æ—…è¡Œå…±ç­†è¡Œç¨‹è¡¨</p>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('itinerary')">è¡Œç¨‹</div>
            <div class="tab" onclick="switchTab('expenses')">è¨˜å¸³</div>
        </div>
    </header>

    <!-- è¡Œç¨‹é é¢ -->
    <div id="itinerary" class="content-section active">
        <div id="loading" style="text-align:center; padding:30px; color:#999; font-size:13px;">
            <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨é€£ç·šåŒæ­¥ä¸­...
        </div>
        <div id="itinerary-list"></div>
    </div>

    <!-- è¨˜å¸³é é¢ -->
    <div id="expenses" class="content-section">
        <div class="total-card">
            <div class="label">ç›®å‰ç¸½èŠ±è²» (TWD)</div>
            <div class="amount" id="total-twd">0</div>
            <div class="rate">åŒ¯ç‡è¨­å®šï¼š1 KRW = <span id="rate-display">0.024</span> TWD</div>
        </div>
        <div id="expense-list"></div>
    </div>

    <!-- æ–°å¢æŒ‰éˆ• -->
    <div class="fab" onclick="openModal()">+</div>

    <!-- æ–°å¢è¦–çª— -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">æ–°å¢é …ç›®</h3>
            
            <div class="form-group">
                <label>ä½ è¦æ–°å¢ä»€éº¼ï¼Ÿ</label>
                <select id="entry-type" class="form-input" onchange="toggleForm()">
                    <option value="plan">ğŸ“ è¡Œç¨‹æ™¯é»</option>
                    <option value="expense">ğŸ’° æ¶ˆè²»è¨˜å¸³</option>
                </select>
            </div>

            <!-- è¡Œç¨‹è¼¸å…¥ -->
            <div id="form-plan">
                <div class="form-group"><label>æ—¥æœŸ</label><input type="date" id="p-date" class="form-input"></div>
                <div class="form-group"><label>æ™‚é–“</label><input type="time" id="p-time" class="form-input"></div>
                <div class="form-group"><label>æ™¯é» / é¤å»³åç¨±</label><input type="text" id="p-title" class="form-input" placeholder="ä¾‹ï¼šå¼˜å¤§çƒ¤è‚‰"></div>
                <div class="form-group"><label>Naver Map ç¶²å€ (é¸å¡«)</label><input type="text" id="p-link" class="form-input" placeholder="è²¼ä¸Šåˆ†äº«é€£çµ..."></div>
                <div class="form-group"><label>å‚™è¨»</label><textarea id="p-note" class="form-input" rows="3" placeholder="å‚™è¨»..."></textarea></div>
            </div>

            <!-- è¨˜å¸³è¼¸å…¥ -->
            <div id="form-expense" style="display:none;">
                <div class="form-group"><label>æ¶ˆè²»é …ç›®</label><input type="text" id="e-title" class="form-input" placeholder="ä¾‹ï¼šè¨ˆç¨‹è»Šè²»"></div>
                <div class="form-group"><label>é‡‘é¡ (éŸ“å¹£)</label><input type="number" id="e-krw" class="form-input" placeholder="10000"></div>
                <div class="form-group"><label>ä»˜æ¬¾äºº</label><input type="text" id="e-payer" class="form-input" placeholder="ä¾‹ï¼šå°æ˜"></div>
            </div>

            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-submit" onclick="saveData()">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ ¸å¿ƒé‚è¼¯ -->
    <script type="module">
        // åŒ¯å…¥ Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, push, remove, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ====================================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ è«‹åœ¨ä¸‹æ–¹å¼•è™Ÿä¸­è²¼å…¥ä½ çš„ Firebase Config ğŸ‘‡ğŸ‘‡ğŸ‘‡
        // ====================================================
       const firebaseConfig = {
  apiKey: "AIzaSyB5QsApcXVlKSpkr57yq1hDQ72HPKMs7MI",
  authDomain: "koreatrip2026-c9256.firebaseapp.com",
  projectId: "koreatrip2026-c9256",
  storageBucket: "koreatrip2026-c9256.firebasestorage.app",
  messagingSenderId: "20290951854",
  appId: "1:20290951854:web:eb4ab85340525ab3116b3f"
};

        };
        // ====================================================

        // åˆå§‹åŒ–
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const rate = 0.024; // åŒ¯ç‡è¨­å®š

        // ç›£è½è¡Œç¨‹è³‡æ–™
        onValue(ref(db, 'plans'), (snapshot) => {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('sync-dot').style.display = 'inline-block';
            const list = document.getElementById('itinerary-list');
            list.innerHTML = '';
            
            const data = snapshot.val();
            if(data) {
                // è½‰é™£åˆ—ä¸¦æ’åº
                const items = Object.entries(data).map(([k,v]) => ({id:k, ...v}));
                items.sort((a,b) => (a.date + a.time).localeCompare(b.date + b.time));

                // åˆ†çµ„é¡¯ç¤º
                const grouped = items.reduce((acc, curr) => {
                    (acc[curr.date] = acc[curr.date] || []).push(curr); return acc;
                }, {});

                Object.keys(grouped).sort().forEach(date => {
                    let html = `<div class="day-header"><span>DAY</span> ${date}</div>`;
                    grouped[date].forEach(item => {
                        const linkBtn = item.link ? `<a href="${item.link}" target="_blank" class="naver-btn">é–‹å•Ÿ Naver Map</a>` : '';
                        html += `
                            <div class="card">
                                <i class="fas fa-trash delete-btn" data-id="${item.id}" data-type="plan"></i>
                                <span class="card-time">${item.time}</span>
                                <div class="card-title">${item.title}</div>
                                <div class="card-desc">${item.note}</div>
                                ${linkBtn}
                            </div>`;
                    });
                    list.innerHTML += html;
                });
            } else {
                list.innerHTML = '<div style="text-align:center;color:#ccc;margin-top:50px;">é»æ“Š + æ–°å¢ç¬¬ä¸€å€‹è¡Œç¨‹</div>';
            }
        });

        // ç›£è½è¨˜å¸³è³‡æ–™
        onValue(ref(db, 'expenses'), (snapshot) => {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            let total = 0;
            const data = snapshot.val();
            
            if(data) {
                Object.entries(data).forEach(([key, item]) => {
                    const twd = Math.round(item.krw * rate);
                    total += twd;
                    list.innerHTML += `
                        <div class="expense-item">
                            <div class="expense-left">
                                <h4>${item.title}</h4>
                                <p>${item.payer} å…ˆä»˜ â€¢ â‚©${item.krw}</p>
                            </div>
                            <div class="expense-right">
                                <div class="expense-twd">NT$ ${twd}</div>
                                <i class="fas fa-trash delete-btn" style="position:static; color:#eee; font-size:12px;" data-id="${key}" data-type="expense"></i>
                            </div>
                        </div>`;
                });
            }
            document.getElementById('total-twd').innerText = total.toLocaleString();
        });

        // å„²å­˜åŠŸèƒ½
        window.saveData = function() {
            const type = document.getElementById('entry-type').value;
            if(type === 'plan') {
                const data = {
                    date: document.getElementById('p-date').value,
                    time: document.getElementById('p-time').value,
                    title: document.getElementById('p-title').value,
                    link: document.getElementById('p-link').value,
                    note: document.getElementById('p-note').value
                };
                if(!data.title) return alert('è«‹è¼¸å…¥æ¨™é¡Œ');
                push(ref(db, 'plans'), data);
            } else {
                const data = {
                    title: document.getElementById('e-title').value,
                    krw: Number(document.getElementById('e-krw').value),
                    payer: document.getElementById('e-payer').value
                };
                if(!data.title) return alert('è«‹è¼¸å…¥æ¨™é¡Œ');
                push(ref(db, 'expenses'), data);
            }
            closeModal();
        };

        // åˆªé™¤åŠŸèƒ½
        document.addEventListener('click', (e) => {
            if(e.target.classList.contains('delete-btn')) {
                const id = e.target.dataset.id;
                const type = e.target.dataset.type + 's'; // plans or expenses
                if(confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿå¤§å®¶éƒ½æœƒçœ‹ä¸åˆ°å–”ï¼')) {
                    remove(ref(db, type + '/' + id));
                }
            }
        });

        // ä»‹é¢æ“ä½œ
        window.switchTab = (t) => {
            document.querySelectorAll('.tab, .content-section').forEach(el => el.classList.remove('active'));
            document.querySelector(`.tab[onclick*="${t}"]`).classList.add('active');
            document.getElementById(t).classList.add('active');
        };
        window.openModal = () => { document.getElementById('modal').style.display = 'flex'; document.getElementById('p-date').valueAsDate = new Date(); };
        window.closeModal = () => document.getElementById('modal').style.display = 'none';
        window.toggleForm = () => {
            const type = document.getElementById('entry-type').value;
            document.getElementById('form-plan').style.display = type === 'plan' ? 'block' : 'none';
            document.getElementById('form-expense').style.display = type === 'expense' ? 'block' : 'none';
        };
    </script>
</body>
</html>